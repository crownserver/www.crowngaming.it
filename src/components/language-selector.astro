---
// Language selector component for switching between IT and EN
---

<div class="language-selector relative inline-block">
  <button
    data-lang-button
    class="flex items-center gap-1 px-3 py-2 text-sm font-medium text-[#333333] hover:text-[#005bea] transition"
    aria-label="Select language"
  >
    <span data-current-lang>IT</span>
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <div
    data-lang-menu
    class="absolute right-0 mt-2 w-24 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50"
  >
    <button
      data-lang="it"
      class="lang-option w-full px-4 py-2 text-left text-sm hover:bg-gray-100 transition first:rounded-t-lg"
    >
      ðŸ‡®ðŸ‡¹ IT
    </button>
    <button
      data-lang="en"
      class="lang-option w-full px-4 py-2 text-left text-sm hover:bg-gray-100 transition last:rounded-b-lg"
    >
      ðŸ‡¬ðŸ‡§ EN
    </button>
  </div>
</div>

<script>
  import { getCurrentLanguage, switchLanguage, type Language } from '@/utils/i18n';

  function initLanguageSelectors() {
    const selectors = document.querySelectorAll('.language-selector');

    selectors.forEach((selector) => {
      const button = selector.querySelector('[data-lang-button]');
      const menu = selector.querySelector('[data-lang-menu]');
      const currentLangSpan = selector.querySelector('[data-current-lang]');
      const langOptions = selector.querySelectorAll('.lang-option');

      if (!button || !menu || !currentLangSpan) return;

      // Set initial language display
      const currentLang = getCurrentLanguage();
      currentLangSpan.textContent = currentLang.toUpperCase();

      // Toggle menu on button click
      button.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('hidden');
      });

      // Handle language selection
      langOptions.forEach((option) => {
        option.addEventListener('click', (e) => {
          const lang = (e.currentTarget as HTMLElement).getAttribute('data-lang') as Language;
          switchLanguage(lang);
        });
      });
    });

    // Close all menus when clicking outside (single global listener)
    document.addEventListener('click', () => {
      document.querySelectorAll('.language-selector [data-lang-menu]').forEach((menu) => {
        menu.classList.add('hidden');
      });
    });
  }

  // Run on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguageSelectors);
  } else {
    initLanguageSelectors();
  }
</script>
